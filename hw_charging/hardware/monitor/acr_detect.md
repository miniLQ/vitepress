---
outline: deep
---

# ACR Detect æ¨¡å—åˆ†æ

## 1. æ¨¡å—å®šä½ä¸æ ¸å¿ƒä»·å€¼

acr_detect æ˜¯åä¸ºå……ç”µç®¡ç†ç³»ç»Ÿä¸­çš„ **ACRï¼ˆAlternating Current Resistanceï¼Œäº¤æµé˜»æŠ—ï¼‰å¼‚å¸¸æ£€æµ‹æ¨¡å—**ï¼Œç”¨äºç›‘æµ‹ç”µæ± çš„å†…é˜»çŠ¶æ€ï¼Œåˆ¤æ–­ç”µæ± å¥åº·ç¨‹åº¦ã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- ğŸ”‹ **ç”µæ± å¥åº·ç›‘æµ‹**ï¼šé€šè¿‡æµ‹é‡ ACR å€¼è¯„ä¼°ç”µæ± è€åŒ–ç¨‹åº¦
- ğŸ›¡ï¸ **å¼‚å¸¸é¢„è­¦**ï¼šè¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘ DMD/FMD æŠ¥å‘Š
- ğŸ­ **äº§çº¿æ£€æµ‹**ï¼šå·¥å‚æ¨¡å¼ä¸‹æ”¯æŒè¿è¡Œæ—¶æ£€æµ‹
- ğŸ“Š **æ•°æ®é‡‡é›†**ï¼šé›†æˆåä¸ºå¤§æ•°æ®å¹³å°ï¼Œæ”¯æŒ FMD ä¸ŠæŠ¥

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç©ºé—´/äº§çº¿å·¥å…·                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ sysfs
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                         â”‚
          â–¼                         â–¼
    acr_rt_support            acr_rt_detect
      (æ˜¯å¦æ”¯æŒ)                (è§¦å‘æ£€æµ‹)
          â”‚                         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  acr_detect.c (æ ¸å¿ƒé€»è¾‘)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å¯åŠ¨æ£€æµ‹å·¥ä½œé˜Ÿåˆ—                                            â”‚
â”‚ â€¢ è®¾ç½®æœ€å¤§è¾“å…¥ç”µæµ                                            â”‚
â”‚ â€¢ ç­‰å¾…ç”µæµé™è‡³ <10mA                                          â”‚
â”‚ â€¢ è°ƒç”¨å¹³å°æ¥å£è®¡ç®— ACR                                        â”‚
â”‚ â€¢ æ¯”å¯¹é˜ˆå€¼å¹¶ä¸ŠæŠ¥å¼‚å¸¸                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Platform API â”‚ â”‚  DMD Report  â”‚ â”‚  FMD Report  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ start_acr_   â”‚ â”‚ POWER_DSM_   â”‚ â”‚ Data Acqu-   â”‚
â”‚   calc()     â”‚ â”‚  BATTERY     â”‚ â”‚  isition     â”‚
â”‚              â”‚ â”‚              â”‚ â”‚  System      â”‚
â”‚ get_acr_     â”‚ â”‚ ERROR_BATT_  â”‚ â”‚              â”‚
â”‚  resistance()â”‚ â”‚  ACR_OVER_   â”‚ â”‚ Item ID:     â”‚
â”‚              â”‚ â”‚  THRESHOLD   â”‚ â”‚ 703023001    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ACR æ£€æµ‹åŸç†

**ACRï¼ˆäº¤æµå†…é˜»ï¼‰å®šä¹‰ï¼š**
- åæ˜ ç”µæ± åœ¨äº¤æµæ¡ä»¶ä¸‹çš„é˜»æŠ—ç‰¹æ€§
- éšç€ç”µæ± è€åŒ–ï¼ŒACR å€¼ä¼šé€æ¸å¢å¤§
- æ­£å¸¸èŒƒå›´ï¼š40-90mÎ©ï¼ˆå¯é…ç½®ï¼‰

**æµ‹é‡æ¡ä»¶ï¼š**
1. **é™æ€ç”µæµ**ï¼šç”µæ± ç”µæµ < 10mAï¼ˆæ¥è¿‘ç©ºè½½çŠ¶æ€ï¼‰
2. **å……ç”µæ¨¡å¼**ï¼šè®¾ç½®æœ€å¤§è¾“å…¥ç”µæµåç­‰å¾…ç¨³å®š
3. **æµ‹é‡æ—¶é•¿**ï¼š1000ms è®¡ç®—æ—¶é—´

## 3. æ ¸å¿ƒæ•°æ®ç»“æ„

### 3.1 è®¾å¤‡ç»“æ„

```c
struct acr_det_dev {
    struct device *dev;              // è®¾å¤‡æŒ‡é’ˆ
    struct delayed_work rt_work;     // å»¶è¿Ÿå·¥ä½œé˜Ÿåˆ—ï¼ˆè¿è¡Œæ—¶æ£€æµ‹ï¼‰
    int rt_run;                      // è¿è¡ŒçŠ¶æ€ï¼ˆ0=æœªè¿è¡Œ, 1=è¿è¡Œä¸­ï¼‰
    u32 rt_support;                  // æ˜¯å¦æ”¯æŒè¿è¡Œæ—¶æ£€æµ‹
    int rt_status;                   // æ£€æµ‹çŠ¶æ€ï¼ˆåˆå§‹åŒ–/å¤±è´¥/æˆåŠŸï¼‰
    int rt_threshold;                // ACR é˜ˆå€¼ï¼ˆå•ä½ï¼šmÎ©ï¼‰
    u32 rt_fmd_min;                  // FMD æœ€å°é˜ˆå€¼ï¼ˆé»˜è®¤ 40mÎ©ï¼‰
    u32 rt_fmd_max;                  // FMD æœ€å¤§é˜ˆå€¼ï¼ˆé»˜è®¤ 90mÎ©ï¼‰
};
```

### 3.2 æ£€æµ‹çŠ¶æ€

```c
enum acr_det_status_type {
    ACR_DET_STATUS_INIT = 0,   // åˆå§‹çŠ¶æ€
    ACR_DET_STATUS_FAIL,       // æ£€æµ‹å¤±è´¥
    ACR_DET_STATUS_SUCC,       // æ£€æµ‹æˆåŠŸ
};
```

### 3.3 è¿è¡ŒçŠ¶æ€

```c
#define ACR_DET_NOT_RUNNING    0   // æœªè¿è¡Œ
#define ACR_DET_RUNNING        1   // è¿è¡Œä¸­
```

### 3.4 é…ç½®å‚æ•°

```c
#define ACR_DET_RETRY_TIMES        50    // æœ€å¤§é‡è¯•æ¬¡æ•°
#define ACR_DET_MIN_CURRENT        10    // æœ€å°ç”µæµé˜ˆå€¼ï¼ˆ10mAï¼‰
#define ACR_DET_DEFAULT_THLD       100   // é»˜è®¤é˜ˆå€¼ï¼ˆ100mÎ©ï¼‰
#define ACR_DET_DEFAULT_MIN_FMD    40    // FMD æœ€å°å€¼ï¼ˆ40mÎ©ï¼‰
#define ACR_DET_DEFAULT_MAX_FMD    90    // FMD æœ€å¤§å€¼ï¼ˆ90mÎ©ï¼‰
```

## 4. æ ¸å¿ƒæµç¨‹å®ç°

### 4.1 å®Œæ•´æ£€æµ‹æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·ç©ºé—´è§¦å‘                                              â”‚
â”‚    echo 1 > /sys/class/hw_power/charger/acr/acr_rt_detect   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ£€æŸ¥å‰ç½®æ¡ä»¶                                              â”‚
â”‚    â€¢ rt_support == 1 (åŠŸèƒ½ä½¿èƒ½)                             â”‚
â”‚    â€¢ factory_mode (å·¥å‚æ¨¡å¼)                                 â”‚
â”‚    â€¢ rt_run == NOT_RUNNING (æœªåœ¨è¿è¡Œ)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è°ƒåº¦å»¶è¿Ÿå·¥ä½œé˜Ÿåˆ—                                          â”‚
â”‚    schedule_delayed_work(&rt_work, 0)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. acr_det_rt_work() æ‰§è¡Œ                                    â”‚
â”‚    rt_run = RUNNING                                          â”‚
â”‚    â†“                                                         â”‚
â”‚    power_platform_set_max_input_current()                    â”‚
â”‚    (è®¾ç½®æœ€å¤§è¾“å…¥ç”µæµï¼Œå‡†å¤‡å……ç”µç¯å¢ƒ)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç­‰å¾…ç”µæµç¨³å®šï¼ˆæœ€å¤šé‡è¯• 50 æ¬¡ï¼‰                             â”‚
â”‚    for (i = 0; i < 50; i++) {                               â”‚
â”‚        ichg = get_battery_current()                          â”‚
â”‚        if (abs(ichg) < 10mA)                                â”‚
â”‚            break; // ç”µæµè¶³å¤Ÿå°ï¼Œå¯ä»¥æµ‹é‡                     â”‚
â”‚        msleep(100); // ç­‰å¾… 100ms                            â”‚
â”‚    }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ACR æµ‹é‡åºåˆ—                                              â”‚
â”‚    â‘  power_platform_start_acr_calc()                         â”‚
â”‚       (å¯åŠ¨ ACR è®¡ç®—)                                        â”‚
â”‚    â‘¡ msleep(1000)                                           â”‚
â”‚       (ç­‰å¾… 1 ç§’ï¼Œå®Œæˆè®¡ç®—)                                   â”‚
â”‚    â‘¢ power_platform_get_acr_resistance(&acr_value)           â”‚
â”‚       (è¯»å– ACR å€¼)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ç»“æœä¸ŠæŠ¥                                                  â”‚
â”‚    â‘  acr_det_fmd_report(acr_value)                           â”‚
â”‚       (FMD æ•°æ®é‡‡é›†ä¸ŠæŠ¥)                                     â”‚
â”‚    â‘¡ msleep(50)                                             â”‚
â”‚       (ç­‰å¾… DSM client é‡Šæ”¾)                                 â”‚
â”‚    â‘¢ if (acr_value > threshold)                             â”‚
â”‚         acr_det_dmd_report(acr_value)                        â”‚
â”‚       (è¶…é˜ˆå€¼åˆ™ DMD å¼‚å¸¸ä¸ŠæŠ¥)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. æ›´æ–°çŠ¶æ€                                                  â”‚
â”‚    rt_status = SUCC / FAIL                                   â”‚
â”‚    rt_run = NOT_RUNNING                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ACR æµ‹é‡æ ¸å¿ƒä»£ç 

```c
static int acr_det_start_detect(struct acr_det_dev *l_dev)
{
    int ret;
    int acr_value = 0;

    /* æ­¥éª¤ 1: å¯åŠ¨ ACR è®¡ç®— */
    power_platform_start_acr_calc();

    /* æ­¥éª¤ 2: ç­‰å¾… 1000msï¼Œè®©ç¡¬ä»¶å®Œæˆè®¡ç®— */
    msleep(1000);

    /* æ­¥éª¤ 3: è¯»å– ACR é˜»æŠ—å€¼ */
    ret = power_platform_get_acr_resistance(&acr_value);
    if (ret == 0) {
        hwlog_info("acr:%d, threshold:%d\n", acr_value, l_dev->rt_threshold);
        
        /* æ­¥éª¤ 4: FMD ä¸ŠæŠ¥ï¼ˆæ•°æ®é‡‡é›†ï¼‰ */
        acr_det_fmd_report(l_dev, acr_value);
        
        /* æ­¥éª¤ 5: ç­‰å¾… 50msï¼Œé¿å… DSM client å†²çª */
        msleep(50);
        
        /* æ­¥éª¤ 6: è¶…é˜ˆå€¼æ—¶ DMD å‘Šè­¦ä¸ŠæŠ¥ */
        if (acr_value > l_dev->rt_threshold)
            acr_det_dmd_report(acr_value);
    }

    return ret;
}
```

### 4.3 ç”µæµç¨³å®šç­‰å¾…é€»è¾‘

```c
static void acr_det_rt_work(struct work_struct *work)
{
    struct acr_det_dev *l_dev = g_acr_det_dev;
    int i;
    int ichg;

    l_dev->rt_run = ACR_DET_RUNNING;

    /* è®¾ç½®æœ€å¤§è¾“å…¥ç”µæµ */
    if (power_platform_set_max_input_current())
        goto detect_fail;

    /* ç­‰å¾…ç”µæµé™è‡³ < 10mAï¼ˆæœ€å¤šé‡è¯• 50 æ¬¡ï¼Œå…± 5 ç§’ï¼‰*/
    for (i = 0; i < ACR_DET_RETRY_TIMES; i++) {
        ichg = -power_platform_get_battery_current();
        hwlog_info("i:%d, ichg:%d\n", i, ichg);
        
        if (abs(ichg) < ACR_DET_MIN_CURRENT) {
            /* ç”µæµè¶³å¤Ÿå°ï¼Œå¼€å§‹æµ‹é‡ */
            if (acr_det_start_detect(l_dev) == 0) {
                l_dev->rt_status = ACR_DET_STATUS_SUCC;
                l_dev->rt_run = ACR_DET_NOT_RUNNING;
                hwlog_info("acr detect succ\n");
                return;
            }
            goto detect_fail;
        }
        
        /* ç­‰å¾… 100ms åé‡è¯• */
        msleep(100);
    }

detect_fail:
    l_dev->rt_status = ACR_DET_STATUS_FAIL;
    l_dev->rt_run = ACR_DET_NOT_RUNNING;
    hwlog_err("acr detect fail\n");
}
```

**ç­‰å¾…é€»è¾‘å›¾ç¤ºï¼š**

```
ç”µæµ (mA)
â”‚
â”‚  1000 â”¼â”€â”€â”€â”€â”€â”€â”
â”‚       â”‚      â”‚
â”‚  500  â”‚      â”‚
â”‚       â”‚      â””â”€â”€â”
â”‚  100  â”‚         â”‚
â”‚       â”‚         â””â”€â”€â”€â”
â”‚   10  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (è¾¾åˆ°é˜ˆå€¼ï¼Œå¼€å§‹æµ‹é‡)
â”‚    0  â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       0ms   100ms  200ms  300ms  ... 5000ms
       â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜
         é‡è¯•1    é‡è¯•2    é‡è¯•3   (æœ€å¤š 50 æ¬¡)
```

## 5. æ•°æ®ä¸ŠæŠ¥æœºåˆ¶

### 5.1 FMD ä¸ŠæŠ¥ï¼ˆæ•°æ®é‡‡é›†ï¼‰

**FMDï¼ˆFault Management Dataï¼‰ï¼š** åä¸ºæ•°æ®é‡‡é›†ç³»ç»Ÿï¼Œç”¨äºäº§å“è´¨é‡åˆ†æ

```c
static void acr_det_fmd_report(struct acr_det_dev *l_dev, int acr_val)
{
    struct message *acr_msg = NULL;

    acr_msg = kzalloc(sizeof(*acr_msg), GFP_KERNEL);
    if (!acr_msg)
        return;

    /* å¡«å……æ¶ˆæ¯å¤´ */
    acr_msg->version = ACR_DET_DEFAULT_VERSION;  // ç‰ˆæœ¬å·ï¼š1
    acr_msg->data_source = DATA_FROM_KERNEL;      // æ•°æ®æ¥æºï¼šå†…æ ¸
    acr_msg->num_events = 1;                      // äº‹ä»¶æ•°é‡ï¼š1

    /* å¡«å……äº‹ä»¶ä¿¡æ¯ */
    acr_msg->events[0].error_code = 0;
    acr_msg->events[0].item_id = ACR_DET_ITEM_ID;  // 703023001
    acr_msg->events[0].cycle = 0;
    
    /* å›ºå®šå­—æ®µ */
    memcpy(acr_msg->events[0].station, "NA", ...);
    memcpy(acr_msg->events[0].bsn, "NA", ...);
    memcpy(acr_msg->events[0].time, "NA", ...);
    memcpy(acr_msg->events[0].device_name, "battery", ...);
    memcpy(acr_msg->events[0].test_name, "BATT_ACR_VAL", ...);
    
    /* é˜ˆå€¼ä¿¡æ¯ */
    snprintf(acr_msg->events[0].min_threshold, MAX_VAL_LEN,
        "%u", l_dev->rt_fmd_min);  // 40
    snprintf(acr_msg->events[0].max_threshold, MAX_VAL_LEN,
        "%u", l_dev->rt_fmd_max);  // 90
    
    /* æµ‹è¯•ç»“æœ */
    if (acr_val > l_dev->rt_threshold)
        memcpy(acr_msg->events[0].result, "fail", ...);
    else
        memcpy(acr_msg->events[0].result, "pass", ...);
    
    /* æµ‹é‡å€¼ */
    snprintf(acr_msg->events[0].value, MAX_VAL_LEN, "%d", acr_val);
    
    /* ç”µæ± ä¿¡æ¯ */
    memcpy(acr_msg->events[0].firmware, batt_brand, MAX_FIRMWARE_LEN);
    snprintf(acr_msg->events[0].description, MAX_DESCRIPTION_LEN,
        "batt_volt:%dmV, batt_temp:%d", batt_volt, batt_temp);

    /* ä¸ŠæŠ¥åˆ°æ•°æ®é‡‡é›†å¹³å° */
    power_dsm_report_fmd(POWER_DSM_BATTERY,
        POWER_DSM_DA_BATTERY_ACR_ERROR_NO, acr_msg);
    
    kfree(acr_msg);
}
```

**FMD æ•°æ®æ ¼å¼ï¼š**

| å­—æ®µ | å€¼ | è¯´æ˜ |
|-----|----|----|
| item_id | 703023001 | ACR æ£€æµ‹é¡¹ ID |
| device_name | battery | è®¾å¤‡åç§° |
| test_name | BATT_ACR_VAL | æµ‹è¯•åç§° |
| min_threshold | 40 | æœ€å°é˜ˆå€¼ï¼ˆmÎ©ï¼‰|
| max_threshold | 90 | æœ€å¤§é˜ˆå€¼ï¼ˆmÎ©ï¼‰|
| result | pass/fail | æµ‹è¯•ç»“æœ |
| value | å®æµ‹å€¼ | ACR æµ‹é‡å€¼ï¼ˆmÎ©ï¼‰|
| firmware | ç”µæ± å“ç‰Œ | å¦‚ "ATL", "SUNWODA" |
| description | ä¸Šä¸‹æ–‡ä¿¡æ¯ | ç”µå‹ã€æ¸©åº¦ç­‰ |

### 5.2 DMD ä¸ŠæŠ¥ï¼ˆå¼‚å¸¸å‘Šè­¦ï¼‰

**DMDï¼ˆDevice Monitor and Diagnosisï¼‰ï¼š** è®¾å¤‡ç›‘æ§ä¸è¯Šæ–­ç³»ç»Ÿ

```c
static void acr_det_dmd_report(int acr_val)
{
    char buf[POWER_DSM_BUF_SIZE_0128] = { 0 };

    /* æ„é€ å¼‚å¸¸ä¿¡æ¯ */
    snprintf(buf, POWER_DSM_BUF_SIZE_0128 - 1,
        "brand:%s, volt:%d, curr:%d, soc:%d, temp:%d, acr:%d\n",
        power_supply_app_get_bat_brand(),          // ç”µæ± å“ç‰Œ
        power_supply_app_get_bat_voltage_now(),    // ç”µæ± ç”µå‹ï¼ˆmVï¼‰
        -power_platform_get_battery_current(),     // å……ç”µç”µæµï¼ˆmAï¼‰
        power_supply_app_get_bat_capacity(),       // ç”µé‡ç™¾åˆ†æ¯”
        power_supply_app_get_bat_temp(),           // ç”µæ± æ¸©åº¦ï¼ˆâ„ƒï¼‰
        acr_val);                                   // ACR å€¼ï¼ˆmÎ©ï¼‰
    
    /* ä¸ŠæŠ¥ DMD å¼‚å¸¸ */
    power_dsm_report_dmd(POWER_DSM_BATTERY,
        POWER_DSM_ERROR_BATT_ACR_OVER_THRESHOLD, buf);
}
```

**DMD ä¸ŠæŠ¥ç¤ºä¾‹ï¼š**
```
brand:ATL, volt:3850, curr:120, soc:45, temp:25, acr:105
```

**è§¦å‘æ¡ä»¶ï¼š** `acr_value > rt_threshold`ï¼ˆé»˜è®¤ 100mÎ©ï¼‰

## 6. Sysfs æ¥å£

### 6.1 æ¥å£åˆ—è¡¨

```bash
# ACR æ£€æµ‹ sysfs èŠ‚ç‚¹è·¯å¾„
/sys/class/hw_power/charger/acr/
â”œâ”€â”€ acr_rt_support   # åªè¯»ï¼Œæ˜¯å¦æ”¯æŒè¿è¡Œæ—¶æ£€æµ‹
â””â”€â”€ acr_rt_detect    # è¯»å†™ï¼Œè§¦å‘æ£€æµ‹/æŸ¥è¯¢çŠ¶æ€
```

### 6.2 æ¥å£è¯¦è§£

#### 6.2.1 acr_rt_supportï¼ˆåªè¯»ï¼‰

**åŠŸèƒ½ï¼š** æŸ¥è¯¢æ˜¯å¦æ”¯æŒ ACR è¿è¡Œæ—¶æ£€æµ‹

```bash
cat /sys/class/hw_power/charger/acr/acr_rt_support
```

**è¿”å›å€¼ï¼š**
- `0` - ä¸æ”¯æŒ
- `1` - æ”¯æŒ

#### 6.2.2 acr_rt_detectï¼ˆè¯»å†™ï¼‰

**åŠŸèƒ½ï¼š** è§¦å‘ ACR æ£€æµ‹ / æŸ¥è¯¢æ£€æµ‹çŠ¶æ€

**å†™æ“ä½œï¼ˆè§¦å‘æ£€æµ‹ï¼‰ï¼š**

```bash
echo 1 > /sys/class/hw_power/charger/acr/acr_rt_detect
```

**å‰ç½®æ¡ä»¶ï¼š**
1. `rt_support == 1`ï¼ˆåŠŸèƒ½ä½¿èƒ½ï¼‰
2. `factory_mode`ï¼ˆå·¥å‚æ¨¡å¼ï¼‰
3. `rt_run == NOT_RUNNING`ï¼ˆæœªåœ¨è¿è¡Œï¼‰

**è¯»æ“ä½œï¼ˆæŸ¥è¯¢çŠ¶æ€ï¼‰ï¼š**

```bash
cat /sys/class/hw_power/charger/acr/acr_rt_detect
```

**è¿”å›å€¼ï¼š**
- `0` - åˆå§‹çŠ¶æ€ï¼ˆACR_DET_STATUS_INITï¼‰
- `1` - æ£€æµ‹å¤±è´¥ï¼ˆACR_DET_STATUS_FAILï¼‰
- `2` - æ£€æµ‹æˆåŠŸï¼ˆACR_DET_STATUS_SUCCï¼‰

### 6.3 ä½¿ç”¨ç¤ºä¾‹

**äº§çº¿æ£€æµ‹è„šæœ¬ï¼š**

```bash
#!/bin/bash

# 1. æ£€æŸ¥æ˜¯å¦æ”¯æŒ
support=$(cat /sys/class/hw_power/charger/acr/acr_rt_support)
if [ "$support" != "1" ]; then
    echo "ACR detect not supported"
    exit 1
fi

# 2. è§¦å‘æ£€æµ‹
echo 1 > /sys/class/hw_power/charger/acr/acr_rt_detect

# 3. ç­‰å¾…æ£€æµ‹å®Œæˆï¼ˆæœ€å¤š 10 ç§’ï¼‰
for i in {1..100}; do
    status=$(cat /sys/class/hw_power/charger/acr/acr_rt_detect)
    if [ "$status" == "2" ]; then
        echo "ACR detect success"
        exit 0
    elif [ "$status" == "1" ]; then
        echo "ACR detect failed"
        exit 1
    fi
    sleep 0.1
done

echo "ACR detect timeout"
exit 1
```

## 7. å…¸å‹åº”ç”¨åœºæ™¯

### 7.1 äº§çº¿è€åŒ–æµ‹è¯•

**åœºæ™¯ï¼š** å·¥å‚äº§çº¿å¯¹ç”µæ± è¿›è¡Œè€åŒ–æµ‹è¯•

```bash
# 1. å……ç”µè‡³æŒ‡å®šç”µé‡ï¼ˆå¦‚ 50%ï¼‰
# 2. æ–­å¼€å……ç”µå™¨ï¼Œç­‰å¾…ç”µæµç¨³å®š
# 3. è§¦å‘ ACR æ£€æµ‹
echo 1 > /sys/class/hw_power/charger/acr/acr_rt_detect

# 4. ç­‰å¾…ç»“æœ
sleep 10
status=$(cat /sys/class/hw_power/charger/acr/acr_rt_detect)

# 5. åˆ¤æ–­ç»“æœ
if [ "$status" == "2" ]; then
    echo "PASS"
else
    echo "FAIL"
fi
```

### 7.2 å”®åè¯Šæ–­å·¥å…·

**åœºæ™¯ï¼š** å”®åæ£€æµ‹ç”µæ± å¥åº·çŠ¶æ€

```java
// Android åº”ç”¨å±‚ä»£ç ç¤ºä¾‹
public class AcrDetector {
    private static final String ACR_SUPPORT = 
        "/sys/class/hw_power/charger/acr/acr_rt_support";
    private static final String ACR_DETECT = 
        "/sys/class/hw_power/charger/acr/acr_rt_detect";
    
    public boolean isSupported() {
        String value = FileUtils.readFile(ACR_SUPPORT);
        return "1".equals(value);
    }
    
    public int startDetect() {
        FileUtils.writeFile(ACR_DETECT, "1");
        
        // ç­‰å¾…æ£€æµ‹å®Œæˆ
        for (int i = 0; i < 100; i++) {
            String status = FileUtils.readFile(ACR_DETECT);
            if ("2".equals(status)) {
                return STATUS_SUCCESS;
            } else if ("1".equals(status)) {
                return STATUS_FAIL;
            }
            Thread.sleep(100);
        }
        
        return STATUS_TIMEOUT;
    }
}
```

### 7.3 ç ”å‘è°ƒè¯•

**åœºæ™¯ï¼š** ç ”å‘äººå‘˜éªŒè¯ ACR åŠŸèƒ½

```bash
# æŸ¥çœ‹ ACR æ£€æµ‹æ—¥å¿—
dmesg | grep acr_detect

# å…¸å‹æ—¥å¿—è¾“å‡ºï¼š
# [  100.123] acr_detect: i:0, ichg:150
# [  100.223] acr_detect: i:1, ichg:120
# [  100.323] acr_detect: i:2, ichg:85
# [  100.423] acr_detect: i:3, ichg:45
# [  100.523] acr_detect: i:4, ichg:8    <- ç”µæµè¾¾åˆ°é˜ˆå€¼
# [  101.623] acr_detect: acr:75, threshold:100
# [  101.673] acr_detect: acr detect succ
```

## 8. DTS é…ç½®

### 8.1 é…ç½®ç¤ºä¾‹

```dts
batt_acr_detect {
    compatible = "huawei,batt_acr_detect";
    status = "ok";
    
    /* æ˜¯å¦æ”¯æŒè¿è¡Œæ—¶æ£€æµ‹ï¼ˆ0=ä¸æ”¯æŒ, 1=æ”¯æŒï¼‰*/
    acr_rt_support = <1>;
    
    /* ACR é˜ˆå€¼ï¼ˆå•ä½ï¼šÎ©ï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸º mÎ©ï¼‰*/
    acr_rt_threshold = <100>;  /* 100Î© â†’ 100000mÎ© */
    
    /* FMD ä¸ŠæŠ¥é˜ˆå€¼èŒƒå›´ */
    acr_rt_fmd_min = <40>;     /* æœ€å°å€¼ 40mÎ© */
    acr_rt_fmd_max = <90>;     /* æœ€å¤§å€¼ 90mÎ© */
};
```

### 8.2 å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|------|-------|------|
| acr_rt_support | u32 | 0 | æ˜¯å¦æ”¯æŒè¿è¡Œæ—¶æ£€æµ‹ |
| acr_rt_threshold | u32 | 100 | ACR é˜ˆå€¼ï¼ˆÎ©ï¼Œä¼šÃ—1000 è½¬ä¸º mÎ©ï¼‰|
| acr_rt_fmd_min | u32 | 40 | FMD æœ€å°é˜ˆå€¼ï¼ˆmÎ©ï¼‰|
| acr_rt_fmd_max | u32 | 90 | FMD æœ€å¤§é˜ˆå€¼ï¼ˆmÎ©ï¼‰|

## 9. è°ƒè¯•æ–¹æ³•

### 9.1 æ—¥å¿—åˆ†æ

**ä½¿èƒ½åŠ¨æ€æ—¥å¿—ï¼š**

```bash
echo 'file acr_detect.c +p' > /sys/kernel/debug/dynamic_debug/control
```

**å…³é”®æ—¥å¿—ï¼š**

```bash
# æ£€æµ‹å¯åŠ¨
[acr_detect] acr detect is running

# ç”µæµç­‰å¾…è¿‡ç¨‹
[acr_detect] i:0, ichg:150
[acr_detect] i:1, ichg:120
...
[acr_detect] i:4, ichg:8

# ACR æµ‹é‡ç»“æœ
[acr_detect] acr:75, threshold:100

# æ£€æµ‹æˆåŠŸ/å¤±è´¥
[acr_detect] acr detect succ
[acr_detect] acr detect fail
```

### 9.2 æ•…éšœè¯Šæ–­æµç¨‹

```
é—®é¢˜ï¼šACR æ£€æµ‹å¤±è´¥
  â”œâ”€ 1. æ£€æŸ¥åŠŸèƒ½æ˜¯å¦ä½¿èƒ½
  â”‚    â””â”€ cat /sys/class/hw_power/charger/acr/acr_rt_support
  â”‚       ï¼ˆåº”è¿”å› 1ï¼‰
  â”‚
  â”œâ”€ 2. ç¡®è®¤å·¥å‚æ¨¡å¼
  â”‚    â””â”€ cat /proc/cmdline | grep factory
  â”‚       ï¼ˆåº”åŒ…å« androidboot.mode=factoryï¼‰
  â”‚
  â”œâ”€ 3. æ£€æŸ¥ç”µæµæ˜¯å¦ç¨³å®š
  â”‚    â””â”€ dmesg | grep "ichg"
  â”‚       ï¼ˆè§‚å¯Ÿç”µæµæ˜¯å¦èƒ½é™è‡³ <10mAï¼‰
  â”‚
  â”œâ”€ 4. éªŒè¯å¹³å°æ¥å£
  â”‚    â””â”€ power_platform_get_acr_resistance() æ˜¯å¦å®ç°
  â”‚
  â””â”€ 5. æŸ¥çœ‹ DMD/FMD ä¸ŠæŠ¥
       â””â”€ dmesg | grep "dsm"
```

### 9.3 æµ‹è¯•æ£€æŸ¥ç‚¹

| æ£€æŸ¥é¡¹ | é¢„æœŸç»“æœ | æ£€æŸ¥æ–¹æ³• |
|-------|---------|---------|
| åŠŸèƒ½ä½¿èƒ½ | rt_support=1 | cat acr_rt_support |
| å·¥å‚æ¨¡å¼ | cmdline åŒ…å« factory | cat /proc/cmdline |
| ç”µæµç¨³å®š | ichg < 10mA | dmesg grep ichg |
| ACR æµ‹é‡ | è¿”å›æœ‰æ•ˆå€¼ | dmesg grep "acr:" |
| çŠ¶æ€æ›´æ–° | rt_status=2 | cat acr_rt_detect |
| FMD ä¸ŠæŠ¥ | æ•°æ®é‡‡é›†æˆåŠŸ | æ£€æŸ¥ FMD å¹³å° |
| DMD ä¸ŠæŠ¥ | è¶…é˜ˆå€¼æ—¶è§¦å‘ | dmesg grep dsm |

## 10. è®¾è®¡äº®ç‚¹

### 10.1 ç”µæµç¨³å®šç­‰å¾…æœºåˆ¶

**é—®é¢˜ï¼š** ACR æµ‹é‡éœ€è¦é™æ€æ¡ä»¶ï¼ˆç”µæµ <10mAï¼‰

**è§£å†³æ–¹æ¡ˆï¼š** å¾ªç¯æ£€æµ‹ + å»¶è¿Ÿç­‰å¾…

```c
for (i = 0; i < ACR_DET_RETRY_TIMES; i++) {
    ichg = get_battery_current();
    if (abs(ichg) < ACR_DET_MIN_CURRENT) {
        // ç”µæµè¶³å¤Ÿå°ï¼Œå¼€å§‹æµ‹é‡
        break;
    }
    msleep(100);  // ç­‰å¾… 100ms åé‡è¯•
}
```

**ä¼˜ç‚¹ï¼š**
- âœ… è‡ªé€‚åº”ç­‰å¾…ï¼Œé¿å…å›ºå®šå»¶è¿Ÿæµªè´¹æ—¶é—´
- âœ… æœ‰è¶…æ—¶ä¿æŠ¤ï¼ˆæœ€å¤š 5 ç§’ï¼‰
- âœ… æ—¥å¿—è®°å½•æ¯æ¬¡ç”µæµå€¼ï¼Œä¾¿äºè°ƒè¯•

### 10.2 DMD/FMD åŒé‡ä¸ŠæŠ¥

**DMDï¼š** è®¾å¤‡å¼‚å¸¸ç›‘æ§ï¼Œè§¦å‘å‘Šè­¦
- ä»…åœ¨ `acr > threshold` æ—¶ä¸ŠæŠ¥
- ç”¨äºå”®åé—®é¢˜è¿½è¸ª

**FMDï¼š** æ•°æ®é‡‡é›†å¹³å°ï¼Œè´¨é‡åˆ†æ
- æ¯æ¬¡æµ‹é‡éƒ½ä¸ŠæŠ¥ï¼ˆåŒ…æ‹¬æ­£å¸¸å’Œå¼‚å¸¸ï¼‰
- ç”¨äºå¤§æ•°æ®åˆ†æã€è´¨é‡æ”¹è¿›

**æ—¶åºæ§åˆ¶ï¼š**
```c
acr_det_fmd_report(acr_value);  // å…ˆ FMD
msleep(50);                      // å»¶è¿Ÿ 50msï¼Œé¿å… DSM client å†²çª
if (acr_value > threshold)
    acr_det_dmd_report(acr_value);  // å DMD
```

### 10.3 å·¥å‚æ¨¡å¼é™åˆ¶

**å®‰å…¨è€ƒè™‘ï¼š** ä»…å·¥å‚æ¨¡å¼å¯è§¦å‘æ£€æµ‹

```c
if (!power_cmdline_is_factory_mode()) {
    hwlog_info("acr detect not support on normal mode\n");
    return -EINVAL;
}
```

**åŸå› ï¼š**
- ğŸ”’ é¿å…ç”¨æˆ·è¯¯æ“ä½œ
- ğŸ›¡ï¸ ACR æ£€æµ‹éœ€è¦ç‰¹æ®Šå……ç”µæ¡ä»¶
- ğŸ“Š ä»…ç”¨äºäº§çº¿/å”®ååœºæ™¯

### 10.4 çŠ¶æ€æœºè®¾è®¡

```
        INIT (0)
          â”‚
          â”‚ echo 1 > acr_rt_detect
          â–¼
      RUNNING
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â–¼           â–¼
  SUCC (2)   FAIL (1)
```

**çŠ¶æ€è½¬æ¢ï¼š**
1. INIT â†’ `RUNNING`ï¼šç”¨æˆ·è§¦å‘æ£€æµ‹
2. `RUNNING` â†’ `SUCC`ï¼šæ£€æµ‹æˆåŠŸ
3. `RUNNING` â†’ `FAIL`ï¼šæ£€æµ‹å¤±è´¥

## 11. æ€»ç»“

acr_detect æ¨¡å—æ˜¯åä¸ºå……ç”µç®¡ç†ç³»ç»Ÿä¸­çš„**ç”µæ± å¥åº·ç›‘æµ‹ç»„ä»¶**ï¼Œé€šè¿‡ä»¥ä¸‹è®¾è®¡å®ç°äº†å¯é çš„ ACR æ£€æµ‹ï¼š

**æ ¸å¿ƒç‰¹æ€§ï¼š**
1. âœ… **æ™ºèƒ½ç­‰å¾…**ï¼šè‡ªé€‚åº”ç”µæµç¨³å®šæ£€æµ‹ï¼ˆæœ€å¤š 5 ç§’ï¼‰
2. âœ… **åŒé‡ä¸ŠæŠ¥**ï¼šDMD å‘Šè­¦ + FMD æ•°æ®é‡‡é›†
3. âœ… **å®‰å…¨é™åˆ¶**ï¼šä»…å·¥å‚æ¨¡å¼å¯ç”¨ï¼Œé¿å…è¯¯æ“ä½œ
4. âœ… **çŠ¶æ€ç®¡ç†**ï¼šæ¸…æ™°çš„çŠ¶æ€æœºè®¾è®¡ï¼ˆINIT/FAIL/SUCCï¼‰

**åº”ç”¨ä»·å€¼ï¼š**
- ğŸ­ **äº§çº¿æ£€æµ‹**ï¼šç”µæ± è€åŒ–æµ‹è¯•ã€å‡ºå‚è´¨æ£€
- ğŸ”§ **å”®åè¯Šæ–­**ï¼šç”µæ± å¥åº·çŠ¶æ€è¯„ä¼°
- ğŸ“Š **æ•°æ®é‡‡é›†**ï¼šè´¨é‡åˆ†æã€äº§å“æ”¹è¿›
- ğŸ›¡ï¸ **å¼‚å¸¸é¢„è­¦**ï¼šACR è¶…é˜ˆå€¼æ—¶è§¦å‘å‘Šè­¦

**å…¸å‹æµç¨‹ï¼š**
1. è®¾ç½®æœ€å¤§è¾“å…¥ç”µæµ â†’ 2. ç­‰å¾…ç”µæµ <10mA â†’ 3. æµ‹é‡ ACR â†’ 4. ä¸ŠæŠ¥ç»“æœ

è¯¥æ¨¡å—å……åˆ†ä½“ç°äº†**æµ‹é‡æ¡ä»¶æ§åˆ¶**å’Œ**å¤šç»´åº¦æ•°æ®ä¸ŠæŠ¥**çš„è®¾è®¡æ€æƒ³ï¼Œæ˜¯ç”µæ± å¥åº·ç›‘æµ‹çš„é‡è¦ç»„ä»¶ã€‚